---
import type { CollectionEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import dayjs from "dayjs";
import Root from "@/layouts/Root.astro";

import "@/styles/shiki.css";
import "@/styles/markdown.css";

export async function getStaticPaths() {
    const posts = await getCollection("blog");

    return posts.map((post) => ({ params: { post: post.id }, props: post }));
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;

const { Content, remarkPluginFrontmatter } = await render(post);
const { title, description, pubDate, minutesRead } = post.data;
---

<Root
    title={title}
    description={description}
    overrideTitle={true}
    pubDate={dayjs(pubDate, "YYYY-MM-DD").format("MMMM D, YYYY")}>
    <div
        class="w-11/12 sm:w-3/4 lg:w-1/2 mx-auto mt-12 border-gray-400 rounded-md p-5 sm:p-8 md:p-12
        prose
        prose-gray-900
        prose-headings:prose-gray-1000
        prose-code:font-mono
        prose-td:border-gray-400
        prose-th:border-gray-400
        prose-a:(text-blue-900 decoration-none)
        hover:(prose-a:text-blue-800 prose-a:decoration-underline)">
        <div class="w-full h-full">
            <h1 class="text-primary">{title}</h1>
            <div class="w-full h-full">
                <div class="flex flex-row items-center gap-1 text-secondary h-fit">
                    <span
                        >{dayjs(pubDate, "YYYY-MM-DD").format("MMMM D, YYYY")} Â· {
                            minutesRead ? `${minutesRead} min read` : remarkPluginFrontmatter.minutesRead
                        }</span
                    >
                </div>
            </div>
        </div>
        <div class="w-full h-full prose mx-auto">
            <Content />
        </div>

        <div class="flex flex-col gap-3 mt-12 not-prose">
            <a href="/blog" class="text-secondary underline-primary w-fit">
                <span>{">"} cd /blog</span>
            </a>
            <a href="/" class="text-secondary underline-primary w-fit">
                <span>{">"} cd /home</span>
            </a>
        </div>
    </div>
</Root>
